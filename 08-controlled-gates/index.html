<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controlled Gates - Quantum Gates Learning</title>
    <link rel="stylesheet" href="../shared/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        .prereq-box { background: linear-gradient(135deg, rgba(100,255,218,0.1), rgba(78,205,196,0.05)); border: 2px solid rgba(100,255,218,0.3); border-radius: 16px; padding: 25px; margin: 20px 0; }
        .prereq-box h3 { color: #64ffda; margin-bottom: 15px; }
        .prereq-item { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin: 12px 0; border-left: 4px solid #64ffda; }
        .prereq-item h4 { color: #4ecdc4; margin-bottom: 8px; }
        .circuit-visual { background: rgba(0,0,0,0.4); border-radius: 12px; padding: 30px; margin: 20px 0; text-align: center; }
        .circuit-svg { max-width: 100%; }
        .gate-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .gate-panel { background: rgba(100,255,218,0.05); border: 1px solid rgba(100,255,218,0.2); border-radius: 12px; padding: 20px; }
        .gate-panel h4 { color: #64ffda; text-align: center; margin-bottom: 15px; }
        .matrix-display { display: flex; justify-content: center; margin: 15px 0; }
        .matrix-box { display: inline-grid; gap: 2px; background: rgba(0,0,0,0.4); padding: 8px; border-radius: 6px; border: 1px solid rgba(100,255,218,0.3); }
        .matrix-4x4 { grid-template-columns: repeat(4, 35px); }
        .matrix-box .cell { width: 35px; height: 28px; display: flex; align-items: center; justify-content: center; background: rgba(100,255,218,0.15); color: #fff; font-size: 12px; border-radius: 3px; }
        .interactive-section { background: linear-gradient(135deg, rgba(100,255,218,0.08), rgba(78,205,196,0.03)); border: 2px solid rgba(100,255,218,0.3); border-radius: 16px; padding: 25px; margin: 25px 0; }
        .qubit-row { display: flex; align-items: center; gap: 20px; margin: 15px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; }
        .qubit-label { min-width: 100px; color: #64ffda; font-weight: bold; }
        .qubit-state { display: flex; gap: 10px; }
        .state-btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .state-btn.active { background: linear-gradient(135deg, #64ffda, #4ecdc4); color: #000; }
        .state-btn:not(.active) { background: rgba(100,255,218,0.2); color: #64ffda; }
        .apply-btn { padding: 12px 30px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: #fff; transition: all 0.3s; margin: 10px; }
        .apply-btn:hover { transform: scale(1.05); }
        .result-display { text-align: center; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 12px; margin-top: 20px; }
        .result-display h4 { color: #64ffda; margin-bottom: 10px; }
        .result-state { font-size: 28px; color: #fff; font-family: monospace; }
        .truth-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .truth-table th, .truth-table td { padding: 12px; text-align: center; border: 1px solid rgba(100,255,218,0.2); }
        .truth-table th { background: rgba(100,255,218,0.1); color: #64ffda; }
        .truth-table td { background: rgba(0,0,0,0.2); }
        .truth-table .changed { color: #ff6b6b; font-weight: bold; }
        .decision-guide { background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); border-radius: 12px; padding: 20px; margin: 20px 0; }
        .decision-guide h3 { color: #ffd93d; margin-bottom: 15px; }
        .decision-item { display: flex; align-items: flex-start; gap: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; margin: 10px 0; }
        .decision-item .goal { color: #4ecdc4; font-weight: bold; min-width: 200px; }
        .decision-item .solution { color: #fff; }
        .decision-item .gate { color: #ff6b6b; font-weight: bold; }
        .dual-bloch { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .bloch-panel { background: rgba(100,255,218,0.05); border: 1px solid rgba(100,255,218,0.2); border-radius: 12px; padding: 15px; }
        .bloch-panel h4 { color: #64ffda; text-align: center; margin-bottom: 10px; }
        .mini-bloch { width: 100%; height: 200px; border-radius: 8px; background: #050505; }
        .state-label { text-align: center; margin-top: 10px; font-family: monospace; color: #fff; font-size: 18px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Controlled Gates</h1>
            <p class="subtitle">CNOT, CZ, and Conditional Quantum Operations</p>
        </header>

        <section class="section">
            <div class="prereq-box">
                <h3>Prerequisites</h3>
                <div class="prereq-item">
                    <h4>1. Two-Qubit States</h4>
                    <p>A two-qubit system has 4 basis states: |00⟩, |01⟩, |10⟩, |11⟩. The first digit is the <strong>control</strong> qubit, the second is the <strong>target</strong>.</p>
                </div>
                <div class="prereq-item">
                    <h4>2. Conditional Logic</h4>
                    <p>Controlled gates apply an operation to the target qubit <strong>only if</strong> the control qubit is |1⟩. If control is |0⟩, nothing happens to target.</p>
                </div>
                <div class="prereq-item">
                    <h4>3. Entanglement</h4>
                    <p>Controlled gates can create <strong>entanglement</strong> - quantum correlations where qubits become linked and can't be described independently.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>CNOT Gate (Controlled-NOT)</h2>
            <p>The most important two-qubit gate! It flips the target qubit if and only if the control qubit is |1⟩.</p>
            
            <div class="circuit-visual">
                <svg class="circuit-svg" width="350" height="120" viewBox="0 0 350 120">
                    <line x1="50" y1="40" x2="300" y2="40" stroke="#64ffda" stroke-width="2"/>
                    <line x1="50" y1="80" x2="300" y2="80" stroke="#64ffda" stroke-width="2"/>
                    <text x="25" y="45" fill="#64ffda" font-size="14">Control</text>
                    <text x="25" y="85" fill="#64ffda" font-size="14">Target</text>
                    <circle cx="175" cy="40" r="8" fill="#64ffda"/>
                    <line x1="175" y1="48" x2="175" y2="62" stroke="#64ffda" stroke-width="2"/>
                    <circle cx="175" cy="80" r="18" fill="none" stroke="#64ffda" stroke-width="2"/>
                    <line x1="157" y1="80" x2="193" y2="80" stroke="#64ffda" stroke-width="2"/>
                    <line x1="175" y1="62" x2="175" y2="98" stroke="#64ffda" stroke-width="2"/>
                </svg>
            </div>

            <div class="gate-grid">
                <div class="gate-panel">
                    <h4>CNOT Matrix</h4>
                    <div class="matrix-display">
                        <div class="matrix-box matrix-4x4">
                            <div class="cell">1</div><div class="cell">0</div><div class="cell">0</div><div class="cell">0</div>
                            <div class="cell">0</div><div class="cell">1</div><div class="cell">0</div><div class="cell">0</div>
                            <div class="cell">0</div><div class="cell">0</div><div class="cell">0</div><div class="cell">1</div>
                            <div class="cell">0</div><div class="cell">0</div><div class="cell">1</div><div class="cell">0</div>
                        </div>
                    </div>
                    <p style="color:#888;text-align:center;font-size:13px;margin-top:10px;">Swaps |10⟩ ↔ |11⟩</p>
                </div>
                <div class="gate-panel">
                    <h4>Truth Table</h4>
                    <table class="truth-table">
                        <tr><th>Input</th><th>Output</th><th>Action</th></tr>
                        <tr><td>|00⟩</td><td>|00⟩</td><td>No change</td></tr>
                        <tr><td>|01⟩</td><td>|01⟩</td><td>No change</td></tr>
                        <tr><td>|10⟩</td><td class="changed">|11⟩</td><td>Target flipped!</td></tr>
                        <tr><td>|11⟩</td><td class="changed">|10⟩</td><td>Target flipped!</td></tr>
                    </table>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Interactive CNOT Simulator</h2>
            <div class="interactive-section">
                <div class="qubit-row">
                    <span class="qubit-label">Control Qubit:</span>
                    <div class="qubit-state">
                        <button class="state-btn active" id="ctrl-0" onclick="setControl(0)">|0⟩</button>
                        <button class="state-btn" id="ctrl-1" onclick="setControl(1)">|1⟩</button>
                        <button class="state-btn" id="ctrl-plus" onclick="setControl('+')">|+⟩</button>
                    </div>
                </div>
                <div class="qubit-row">
                    <span class="qubit-label">Target Qubit:</span>
                    <div class="qubit-state">
                        <button class="state-btn active" id="tgt-0" onclick="setTarget(0)">|0⟩</button>
                        <button class="state-btn" id="tgt-1" onclick="setTarget(1)">|1⟩</button>
                    </div>
                </div>
                <div style="text-align:center;">
                    <button class="apply-btn" onclick="applyCNOT()">Apply CNOT</button>
                    <button class="apply-btn" style="background:linear-gradient(135deg,#666,#888);" onclick="resetQubits()">Reset</button>
                </div>
                <div class="dual-bloch">
                    <div class="bloch-panel">
                        <h4>Control Qubit</h4>
                        <div id="bloch-ctrl" class="mini-bloch"></div>
                        <div class="state-label" id="ctrl-label">|0⟩</div>
                    </div>
                    <div class="bloch-panel">
                        <h4>Target Qubit</h4>
                        <div id="bloch-tgt" class="mini-bloch"></div>
                        <div class="state-label" id="tgt-label">|0⟩</div>
                    </div>
                </div>
                <div class="result-display">
                    <h4>Combined State</h4>
                    <div class="result-state" id="combined-state">|00⟩</div>
                    <p id="entanglement-note" style="color:#888;margin-top:10px;display:none;">This state is ENTANGLED!</p>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="decision-guide">
                <h3>When to Use Controlled Gates</h3>
                <div class="decision-item">
                    <span class="goal">Flip target based on control:</span>
                    <span class="solution">Use <span class="gate">CNOT</span> - quantum XOR operation</span>
                </div>
                <div class="decision-item">
                    <span class="goal">Create Bell state (entanglement):</span>
                    <span class="solution">Apply <span class="gate">H</span> to control, then <span class="gate">CNOT</span></span>
                </div>
                <div class="decision-item">
                    <span class="goal">Add phase based on control:</span>
                    <span class="solution">Use <span class="gate">CZ</span> (controlled-Z)</span>
                </div>
                <div class="decision-item">
                    <span class="goal">Implement classical logic:</span>
                    <span class="solution"><span class="gate">CNOT</span> = reversible XOR gate</span>
                </div>
                <div class="decision-item">
                    <span class="goal">Copy classical bit (not quantum!):</span>
                    <span class="solution"><span class="gate">CNOT</span> with target in |0⟩</span>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>CZ Gate (Controlled-Z)</h2>
            <p>Applies a Z gate (phase flip) to the target if control is |1⟩. Unlike CNOT, CZ is symmetric!</p>
            
            <div class="gate-grid">
                <div class="gate-panel">
                    <h4>CZ Matrix</h4>
                    <div class="matrix-display">
                        <div class="matrix-box matrix-4x4">
                            <div class="cell">1</div><div class="cell">0</div><div class="cell">0</div><div class="cell">0</div>
                            <div class="cell">0</div><div class="cell">1</div><div class="cell">0</div><div class="cell">0</div>
                            <div class="cell">0</div><div class="cell">0</div><div class="cell">1</div><div class="cell">0</div>
                            <div class="cell">0</div><div class="cell">0</div><div class="cell">0</div><div class="cell" style="color:#ff6b6b;">-1</div>
                        </div>
                    </div>
                    <p style="color:#888;text-align:center;font-size:13px;margin-top:10px;">Only |11⟩ gets a phase flip</p>
                </div>
                <div class="gate-panel">
                    <h4>CZ Truth Table</h4>
                    <table class="truth-table">
                        <tr><th>Input</th><th>Output</th><th>Phase</th></tr>
                        <tr><td>|00⟩</td><td>|00⟩</td><td>+1</td></tr>
                        <tr><td>|01⟩</td><td>|01⟩</td><td>+1</td></tr>
                        <tr><td>|10⟩</td><td>|10⟩</td><td>+1</td></tr>
                        <tr><td>|11⟩</td><td class="changed">-|11⟩</td><td style="color:#ff6b6b;">-1</td></tr>
                    </table>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Creating Entanglement</h2>
            <div class="highlight">
                <h3>Bell State Recipe: H + CNOT</h3>
                <p>Starting with |00⟩:</p>
                <ol style="margin-left:20px;color:#888;">
                    <li>Apply H to control: |00⟩ → (|0⟩+|1⟩)/√2 ⊗ |0⟩ = (|00⟩+|10⟩)/√2</li>
                    <li>Apply CNOT: (|00⟩+|10⟩)/√2 → <span style="color:#64ffda;">(|00⟩+|11⟩)/√2</span></li>
                </ol>
                <p style="margin-top:15px;">The result <strong>(|00⟩+|11⟩)/√2</strong> is a Bell state - maximally entangled! Measuring one qubit instantly determines the other.</p>
            </div>
        </section>

        <div class="nav-buttons">
            <a href="../07-multiple-qubit-gates/index.html" class="btn">Previous: Multiple-Qubit Gates</a>
            <a href="../09-swap-toffoli-gates/index.html" class="btn btn-primary">Next: SWAP & Toffoli Gates</a>
        </div>
    </div>

    <script>
    let ctrlState = {theta: 0, phi: 0, label: '|0⟩', isPlus: false};
    let tgtState = {theta: 0, phi: 0, label: '|0⟩'};
    let ctrlArrow, tgtArrow;

    function createBloch(id) {
        const c = document.getElementById(id);
        if (!c) return null;
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);
        const camera = new THREE.PerspectiveCamera(50, c.clientWidth/c.clientHeight, 0.1, 1000);
        camera.position.set(1.8, 1.2, 1.8);
        const renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setSize(c.clientWidth, c.clientHeight);
        c.appendChild(renderer.domElement);
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.enableZoom = false;
        
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const light = new THREE.PointLight(0xffffff, 0.8);
        light.position.set(5,5,5);
        scene.add(light);
        
        scene.add(new THREE.Mesh(new THREE.SphereGeometry(1,24,24), new THREE.MeshPhongMaterial({color:0x64ffda,transparent:true,opacity:0.08})));
        scene.add(new THREE.Mesh(new THREE.SphereGeometry(1,12,12), new THREE.MeshBasicMaterial({color:0x64ffda,wireframe:true,transparent:true,opacity:0.1})));
        
        scene.add(new THREE.ArrowHelper(new THREE.Vector3(1,0,0), new THREE.Vector3(0,0,0), 1.1, 0xff6b6b, 0.06, 0.03));
        scene.add(new THREE.ArrowHelper(new THREE.Vector3(0,1,0), new THREE.Vector3(0,0,0), 1.1, 0x4ecdc4, 0.06, 0.03));
        scene.add(new THREE.ArrowHelper(new THREE.Vector3(0,0,1), new THREE.Vector3(0,0,0), 1.1, 0xffd93d, 0.06, 0.03));
        [{pos:[1.25,0,0],text:'X',color:'#ff6b6b'},{pos:[0,1.25,0],text:'Y',color:'#4ecdc4'},{pos:[0,0,1.25],text:'Z',color:'#ffd93d'}].forEach(l=>{
            const canvas=document.createElement('canvas');canvas.width=32;canvas.height=32;
            const ctx=canvas.getContext('2d');ctx.fillStyle=l.color;ctx.font='bold 20px monospace';ctx.textAlign='center';ctx.fillText(l.text,16,22);
            const sprite=new THREE.Sprite(new THREE.SpriteMaterial({map:new THREE.CanvasTexture(canvas),transparent:true}));
            sprite.position.set(l.pos[0],l.pos[1],l.pos[2]);sprite.scale.set(0.25,0.25,1);scene.add(sprite);
        });
        
        const arrow = new THREE.ArrowHelper(new THREE.Vector3(0,0,1), new THREE.Vector3(0,0,0), 1, 0xffffff, 0.1, 0.06);
        scene.add(arrow);
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
        
        return arrow;
    }
    
    ctrlArrow = createBloch('bloch-ctrl');
    tgtArrow = createBloch('bloch-tgt');

    function setControl(state) {
        document.querySelectorAll('#ctrl-0,#ctrl-1,#ctrl-plus').forEach(b => b.classList.remove('active'));
        if(state === 0) {
            ctrlState = {theta: 0, phi: 0, label: '|0⟩', isPlus: false};
            document.getElementById('ctrl-0').classList.add('active');
        } else if(state === 1) {
            ctrlState = {theta: Math.PI, phi: 0, label: '|1⟩', isPlus: false};
            document.getElementById('ctrl-1').classList.add('active');
        } else if(state === '+') {
            ctrlState = {theta: Math.PI/2, phi: 0, label: '|+⟩', isPlus: true};
            document.getElementById('ctrl-plus').classList.add('active');
        }
        updateDisplay();
    }

    function setTarget(state) {
        document.querySelectorAll('#tgt-0,#tgt-1').forEach(b => b.classList.remove('active'));
        if(state === 0) {
            tgtState = {theta: 0, phi: 0, label: '|0⟩'};
            document.getElementById('tgt-0').classList.add('active');
        } else {
            tgtState = {theta: Math.PI, phi: 0, label: '|1⟩'};
            document.getElementById('tgt-1').classList.add('active');
        }
        updateDisplay();
    }

    function updateDisplay() {
        const cx = Math.sin(ctrlState.theta)*Math.cos(ctrlState.phi);
        const cy = Math.sin(ctrlState.theta)*Math.sin(ctrlState.phi);
        const cz = Math.cos(ctrlState.theta);
        ctrlArrow.setDirection(new THREE.Vector3(cx,cy,cz).normalize());
        
        const tx = Math.sin(tgtState.theta)*Math.cos(tgtState.phi);
        const ty = Math.sin(tgtState.theta)*Math.sin(tgtState.phi);
        const tz = Math.cos(tgtState.theta);
        tgtArrow.setDirection(new THREE.Vector3(tx,ty,tz).normalize());
        
        document.getElementById('ctrl-label').textContent = ctrlState.label;
        document.getElementById('tgt-label').textContent = tgtState.label;
        
        let combined;
        if(ctrlState.isPlus) {
            combined = '(|0' + (tgtState.theta < 0.1 ? '0' : '1') + '⟩ + |1' + (tgtState.theta < 0.1 ? '0' : '1') + '⟩)/√2';
        } else {
            combined = '|' + (ctrlState.theta < 0.1 ? '0' : '1') + (tgtState.theta < 0.1 ? '0' : '1') + '⟩';
        }
        document.getElementById('combined-state').textContent = combined;
        document.getElementById('entanglement-note').style.display = 'none';
    }

    function applyCNOT() {
        if(ctrlState.isPlus) {
            if(tgtState.theta < 0.1) {
                document.getElementById('combined-state').textContent = '(|00⟩ + |11⟩)/√2';
                document.getElementById('entanglement-note').style.display = 'block';
                document.getElementById('entanglement-note').textContent = 'This is a BELL STATE - maximally entangled!';
            } else {
                document.getElementById('combined-state').textContent = '(|01⟩ + |10⟩)/√2';
                document.getElementById('entanglement-note').style.display = 'block';
                document.getElementById('entanglement-note').textContent = 'This is a BELL STATE - maximally entangled!';
            }
        } else if(ctrlState.theta > Math.PI/2) {
            if(tgtState.theta < 0.1) {
                tgtState = {theta: Math.PI, phi: 0, label: '|1⟩'};
            } else {
                tgtState = {theta: 0, phi: 0, label: '|0⟩'};
            }
            updateDisplay();
        }
    }

    function resetQubits() {
        setControl(0);
        setTarget(0);
    }

    updateDisplay();
    </script>
</body>
</html>
