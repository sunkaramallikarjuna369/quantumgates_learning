<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controlled Gates (CNOT, CZ) - Devin's Teaching Style</title>
    <link rel="stylesheet" href="../shared/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        .fourwh-box { background: linear-gradient(135deg, rgba(100,255,218,0.12), rgba(78,205,196,0.06)); border: 2px solid rgba(100,255,218,0.4); border-radius: 16px; padding: 25px; margin: 25px 0; }
        .fourwh-box h3 { color: #64ffda; margin-bottom: 20px; font-size: 1.4em; }
        .fourwh-item { background: rgba(0,0,0,0.4); border-radius: 12px; padding: 20px; margin: 15px 0; border-left: 5px solid; }
        .fourwh-item.what { border-color: #ff6b6b; }
        .fourwh-item.why { border-color: #ffd93d; }
        .fourwh-item.when { border-color: #4ecdc4; }
        .fourwh-item.where { border-color: #a855f7; }
        .fourwh-item.how { border-color: #64ffda; }
        .fourwh-item h4 { margin-bottom: 12px; font-size: 1.2em; }
        .fourwh-item.what h4 { color: #ff6b6b; }
        .fourwh-item.why h4 { color: #ffd93d; }
        .fourwh-item.when h4 { color: #4ecdc4; }
        .fourwh-item.where h4 { color: #a855f7; }
        .fourwh-item.how h4 { color: #64ffda; }
        .fourwh-item p, .fourwh-item li { color: #ccc; line-height: 1.7; }
        .prereq-box { background: linear-gradient(135deg, rgba(168,85,247,0.1), rgba(168,85,247,0.05)); border: 2px solid rgba(168,85,247,0.3); border-radius: 16px; padding: 25px; margin: 20px 0; }
        .prereq-box h3 { color: #a855f7; margin-bottom: 15px; }
        .prereq-item { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin: 12px 0; border-left: 4px solid #a855f7; }
        .prereq-item h4 { color: #c084fc; margin-bottom: 8px; }
        .matrix-derivation { background: rgba(255,215,0,0.08); border: 2px solid rgba(255,215,0,0.3); border-radius: 16px; padding: 25px; margin: 25px 0; }
        .matrix-derivation h3 { color: #ffd93d; margin-bottom: 20px; }
        .derivation-step { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 20px; margin: 15px 0; }
        .derivation-step h4 { color: #4ecdc4; margin-bottom: 12px; }
        .derivation-step .explanation { color: #ccc; line-height: 1.6; }
        .derivation-step .formula { background: rgba(100,255,218,0.1); padding: 15px; border-radius: 8px; margin: 10px 0; font-family: monospace; font-size: 1.1em; color: #64ffda; text-align: center; }
        .matrix-visual { display: flex; align-items: center; justify-content: center; gap: 15px; margin: 20px 0; flex-wrap: wrap; }
        .matrix-box { display: inline-grid; gap: 4px; background: rgba(0,0,0,0.5); padding: 12px; border-radius: 10px; border: 2px solid rgba(100,255,218,0.3); }
        .matrix-box.m4 { grid-template-columns: repeat(4, 40px); }
        .matrix-box .cell { width: 40px; height: 35px; display: flex; align-items: center; justify-content: center; background: rgba(100,255,218,0.15); color: #fff; font-size: 14px; border-radius: 5px; font-family: monospace; }
        .key-insight { background: linear-gradient(135deg, rgba(255,107,107,0.1), rgba(255,107,107,0.05)); border: 2px solid rgba(255,107,107,0.3); border-radius: 12px; padding: 20px; margin: 20px 0; }
        .key-insight h4 { color: #ff6b6b; margin-bottom: 10px; }
        .key-insight p { color: #ccc; line-height: 1.6; }
        .gate-card { background: rgba(0,0,0,0.4); border-radius: 16px; padding: 25px; margin: 25px 0; border: 2px solid; }
        .gate-card.cnot-card { border-color: rgba(255,107,107,0.5); }
        .gate-card.cz-card { border-color: rgba(255,217,61,0.5); }
        .gate-card h3 { margin-bottom: 20px; }
        .gate-card.cnot-card h3 { color: #ff6b6b; }
        .gate-card.cz-card h3 { color: #ffd93d; }
        .simulator { background: rgba(0,0,0,0.5); border-radius: 16px; padding: 25px; margin: 25px 0; border: 2px solid rgba(100,255,218,0.3); }
        .simulator h3 { color: #64ffda; margin-bottom: 20px; }
        .qubit-row { display: flex; align-items: center; gap: 20px; margin: 15px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; }
        .qubit-label { width: 100px; color: #a855f7; font-weight: bold; }
        .qubit-state { font-family: monospace; font-size: 1.3em; color: #64ffda; min-width: 60px; }
        .qubit-toggle { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .qubit-toggle.off { background: rgba(100,255,218,0.2); color: #64ffda; }
        .qubit-toggle.on { background: #64ffda; color: #000; }
        .gate-btn { padding: 15px 30px; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; font-weight: bold; transition: all 0.3s; margin: 10px; }
        .gate-btn:hover { transform: scale(1.05); }
        .gate-btn.cnot { background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: #fff; }
        .gate-btn.cz { background: linear-gradient(135deg, #ffd93d, #ffe66d); color: #000; }
        .gate-btn.h { background: linear-gradient(135deg, #a855f7, #c084fc); color: #fff; }
        .gate-btn.reset { background: linear-gradient(135deg, #666, #888); color: #fff; }
        .result-display { text-align: center; margin-top: 20px; padding: 20px; background: rgba(100,255,218,0.1); border-radius: 10px; }
        .result-display .state { font-size: 1.5em; color: #64ffda; font-family: monospace; }
        .result-display .info { color: #888; margin-top: 10px; }
        .truth-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .truth-table th, .truth-table td { padding: 12px; text-align: center; border: 1px solid rgba(100,255,218,0.3); }
        .truth-table th { background: rgba(100,255,218,0.2); color: #64ffda; }
        .truth-table td { background: rgba(0,0,0,0.3); color: #ccc; font-family: monospace; }
        .circuit-diagram { background: rgba(0,0,0,0.4); border-radius: 12px; padding: 20px; margin: 20px 0; text-align: center; }
        .circuit-diagram svg { max-width: 100%; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Controlled Gates: CNOT and CZ</h1>
            <p class="subtitle">The Building Blocks of Entanglement and Quantum Logic</p>
        </header>

        <section class="section">
            <div class="prereq-box">
                <h3>Prerequisites - Understanding Controlled Operations</h3>
                <div class="prereq-item">
                    <h4>1. What is a Controlled Gate?</h4>
                    <p>A controlled gate applies an operation to a "target" qubit ONLY when a "control" qubit is |1⟩. If control is |0⟩, nothing happens. This is quantum's version of "if-then" logic!</p>
                </div>
                <div class="prereq-item">
                    <h4>2. Control and Target Qubits</h4>
                    <p>The control qubit determines WHETHER the gate acts. The target qubit is WHERE the gate acts. In circuit diagrams: control = filled dot (●), target = operation symbol (⊕ for X, or the gate name).</p>
                </div>
                <div class="prereq-item">
                    <h4>3. Why Controlled Gates Create Entanglement</h4>
                    <p>When control is in superposition |+⟩, the target gets entangled! CNOT|+0⟩ = (1/√2)(|00⟩+|11⟩) - a Bell state. The qubits become correlated: measuring one instantly determines the other.</p>
                </div>
                <div class="prereq-item">
                    <h4>4. Classical XOR Connection</h4>
                    <p>CNOT is the quantum version of XOR. For basis states: CNOT|ab⟩ = |a, a⊕b⟩. The target becomes the XOR of control and original target. This is reversible (unlike classical XOR which loses information).</p>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="fourwh-box">
                <h3>Controlled Gates - The 4W+H Framework</h3>
                
                <div class="fourwh-item what">
                    <h4>WHAT are Controlled Gates?</h4>
                    <p>Controlled gates are 2-qubit operations where one qubit (control) determines whether an operation is applied to another qubit (target). CNOT applies X when control=|1⟩. CZ applies Z when control=|1⟩. Any gate U can be made controlled: CU.</p>
                </div>
                
                <div class="fourwh-item why">
                    <h4>WHY are controlled gates essential?</h4>
                    <p>Controlled gates are the ONLY way to create entanglement from separable states! Single-qubit gates can't entangle. CNOT + single-qubit gates form a universal gate set - they can implement ANY quantum computation. Controlled gates enable quantum error correction, teleportation, and all quantum algorithms.</p>
                </div>
                
                <div class="fourwh-item when">
                    <h4>WHEN to use controlled gates?</h4>
                    <p><strong>CNOT:</strong> Creating Bell states, quantum error correction, arithmetic circuits. <strong>CZ:</strong> Graph state preparation, phase kickback, symmetric entanglement. <strong>General CU:</strong> Controlled rotations in QFT, oracle implementations in Grover/Shor.</p>
                </div>
                
                <div class="fourwh-item where">
                    <h4>WHERE in quantum circuits?</h4>
                    <p>Controlled gates appear after creating superposition (to entangle) and in the middle of algorithms (for conditional logic). In error correction, they spread errors for detection. In oracles, they mark solutions. In QFT, controlled rotations create phase relationships.</p>
                </div>
                
                <div class="fourwh-item how">
                    <h4>HOW do controlled gates work mathematically?</h4>
                    <p>CU = |0⟩⟨0|⊗I + |1⟩⟨1|⊗U. This means: "if control is |0⟩, do nothing (I); if control is |1⟩, apply U". The matrix is block diagonal: [[I, 0], [0, U]] in the control qubit basis.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="simulator">
                <h3>Interactive CNOT/CZ Simulator</h3>
                <p style="color:#888;margin-bottom:20px;">Toggle qubit states and apply gates. Watch how CNOT and CZ behave differently!</p>
                
                <div class="qubit-row">
                    <span class="qubit-label">Control:</span>
                    <span class="qubit-state" id="control-state">|0⟩</span>
                    <button class="qubit-toggle off" id="control-toggle" onclick="toggleQubit('control')">Toggle</button>
                    <button class="gate-btn h" onclick="applyH('control')" style="padding:8px 16px;font-size:14px;">H</button>
                </div>
                
                <div class="qubit-row">
                    <span class="qubit-label">Target:</span>
                    <span class="qubit-state" id="target-state">|0⟩</span>
                    <button class="qubit-toggle off" id="target-toggle" onclick="toggleQubit('target')">Toggle</button>
                    <button class="gate-btn h" onclick="applyH('target')" style="padding:8px 16px;font-size:14px;">H</button>
                </div>
                
                <div style="text-align:center;margin-top:20px;">
                    <button class="gate-btn cnot" onclick="applyCNOT()">Apply CNOT</button>
                    <button class="gate-btn cz" onclick="applyCZ()">Apply CZ</button>
                    <button class="gate-btn reset" onclick="resetSimulator()">Reset</button>
                </div>
                
                <div class="result-display">
                    <div class="state" id="combined-state">|00⟩</div>
                    <div class="info" id="state-info">Separable state: |0⟩⊗|0⟩</div>
                </div>
            </div>
        </section>

        <div class="gate-card cnot-card">
            <h3>CNOT (Controlled-NOT / CX)</h3>
            <div class="fourwh-box" style="margin-top:0;">
                <div class="fourwh-item what">
                    <h4>WHAT does CNOT do?</h4>
                    <p>CNOT flips the target qubit (applies X) when the control qubit is |1⟩. CNOT|00⟩=|00⟩, CNOT|01⟩=|01⟩, CNOT|10⟩=|11⟩, CNOT|11⟩=|10⟩. It's the quantum XOR gate!</p>
                </div>
                <div class="fourwh-item why">
                    <h4>WHY is the CNOT matrix [[1,0,0,0],[0,1,0,0],[0,0,0,1],[0,0,1,0]]?</h4>
                    <p><strong>Step-by-step derivation:</strong></p>
                    <ul style="color:#ccc;margin:10px 0 10px 20px;">
                        <li>CNOT|00⟩ = |00⟩ → column 1 is [1,0,0,0]ᵀ</li>
                        <li>CNOT|01⟩ = |01⟩ → column 2 is [0,1,0,0]ᵀ</li>
                        <li>CNOT|10⟩ = |11⟩ → column 3 is [0,0,0,1]ᵀ</li>
                        <li>CNOT|11⟩ = |10⟩ → column 4 is [0,0,1,0]ᵀ</li>
                    </ul>
                    <div class="matrix-visual">
                        <span style="color:#888;">CNOT = </span>
                        <div class="matrix-box m4" style="border-color:rgba(255,107,107,0.5);">
                            <div class="cell" style="background:rgba(255,107,107,0.2);">1</div><div class="cell" style="background:rgba(255,107,107,0.2);">0</div><div class="cell" style="background:rgba(255,107,107,0.2);">0</div><div class="cell" style="background:rgba(255,107,107,0.2);">0</div>
                            <div class="cell" style="background:rgba(255,107,107,0.2);">0</div><div class="cell" style="background:rgba(255,107,107,0.2);">1</div><div class="cell" style="background:rgba(255,107,107,0.2);">0</div><div class="cell" style="background:rgba(255,107,107,0.2);">0</div>
                            <div class="cell" style="background:rgba(255,107,107,0.2);">0</div><div class="cell" style="background:rgba(255,107,107,0.2);">0</div><div class="cell" style="background:rgba(255,107,107,0.2);">0</div><div class="cell" style="background:rgba(255,107,107,0.2);">1</div>
                            <div class="cell" style="background:rgba(255,107,107,0.2);">0</div><div class="cell" style="background:rgba(255,107,107,0.2);">0</div><div class="cell" style="background:rgba(255,107,107,0.2);">1</div><div class="cell" style="background:rgba(255,107,107,0.2);">0</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <h4 style="color:#ff6b6b;margin-top:20px;">CNOT Truth Table</h4>
            <table class="truth-table">
                <tr><th>Input</th><th>Control</th><th>Target</th><th>Output</th><th>Action</th></tr>
                <tr><td>|00⟩</td><td>0</td><td>0</td><td>|00⟩</td><td>No flip (control=0)</td></tr>
                <tr><td>|01⟩</td><td>0</td><td>1</td><td>|01⟩</td><td>No flip (control=0)</td></tr>
                <tr><td>|10⟩</td><td>1</td><td>0</td><td>|11⟩</td><td>Flip! (control=1)</td></tr>
                <tr><td>|11⟩</td><td>1</td><td>1</td><td>|10⟩</td><td>Flip! (control=1)</td></tr>
            </table>
            
            <div class="key-insight">
                <h4>Key Insight: CNOT creates Bell states!</h4>
                <p>CNOT(H⊗I)|00⟩ = CNOT|+0⟩ = (1/√2)(|00⟩+|11⟩) = |Φ⁺⟩. This is a maximally entangled Bell state! The qubits are perfectly correlated: measuring one as 0 means the other is 0, measuring one as 1 means the other is 1.</p>
            </div>
        </div>

        <div class="gate-card cz-card">
            <h3>CZ (Controlled-Z)</h3>
            <div class="fourwh-box" style="margin-top:0;">
                <div class="fourwh-item what">
                    <h4>WHAT does CZ do?</h4>
                    <p>CZ applies a Z gate (phase flip) to the target when control is |1⟩. But here's the magic: CZ is SYMMETRIC! It doesn't matter which qubit is "control" - CZ|11⟩ = -|11⟩, all other basis states unchanged.</p>
                </div>
                <div class="fourwh-item why">
                    <h4>WHY is the CZ matrix diag(1,1,1,-1)?</h4>
                    <p><strong>Step-by-step derivation:</strong></p>
                    <ul style="color:#ccc;margin:10px 0 10px 20px;">
                        <li>CZ|00⟩ = |00⟩ (control=0, no Z)</li>
                        <li>CZ|01⟩ = |01⟩ (control=0, no Z)</li>
                        <li>CZ|10⟩ = |10⟩ (control=1, Z|0⟩=|0⟩)</li>
                        <li>CZ|11⟩ = -|11⟩ (control=1, Z|1⟩=-|1⟩)</li>
                    </ul>
                    <div class="matrix-visual">
                        <span style="color:#888;">CZ = </span>
                        <div class="matrix-box m4" style="border-color:rgba(255,217,61,0.5);">
                            <div class="cell" style="background:rgba(255,217,61,0.2);">1</div><div class="cell" style="background:rgba(255,217,61,0.2);">0</div><div class="cell" style="background:rgba(255,217,61,0.2);">0</div><div class="cell" style="background:rgba(255,217,61,0.2);">0</div>
                            <div class="cell" style="background:rgba(255,217,61,0.2);">0</div><div class="cell" style="background:rgba(255,217,61,0.2);">1</div><div class="cell" style="background:rgba(255,217,61,0.2);">0</div><div class="cell" style="background:rgba(255,217,61,0.2);">0</div>
                            <div class="cell" style="background:rgba(255,217,61,0.2);">0</div><div class="cell" style="background:rgba(255,217,61,0.2);">0</div><div class="cell" style="background:rgba(255,217,61,0.2);">1</div><div class="cell" style="background:rgba(255,217,61,0.2);">0</div>
                            <div class="cell" style="background:rgba(255,217,61,0.2);">0</div><div class="cell" style="background:rgba(255,217,61,0.2);">0</div><div class="cell" style="background:rgba(255,217,61,0.2);">0</div><div class="cell" style="background:rgba(255,217,61,0.2);">-1</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="key-insight">
                <h4>Key Insight: CZ is symmetric!</h4>
                <p>Unlike CNOT, CZ treats both qubits equally. CZ = (H⊗I)·CNOT·(H⊗I). You can convert between CNOT and CZ using Hadamard gates. CZ is often preferred in hardware because of this symmetry.</p>
            </div>
        </div>

        <section class="section">
            <div class="matrix-derivation">
                <h3>CNOT ↔ CZ Conversion</h3>
                <div class="derivation-step">
                    <h4>CNOT from CZ</h4>
                    <div class="formula">CNOT = (I⊗H) · CZ · (I⊗H)</div>
                    <p class="explanation">Apply H to target before and after CZ to get CNOT.</p>
                </div>
                <div class="derivation-step">
                    <h4>CZ from CNOT</h4>
                    <div class="formula">CZ = (I⊗H) · CNOT · (I⊗H)</div>
                    <p class="explanation">Same transformation works both ways because H is self-inverse!</p>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="matrix-derivation">
                <h3>Creating All Four Bell States</h3>
                <div class="derivation-step">
                    <h4>Bell State Circuit: H on qubit 1, then CNOT</h4>
                    <div class="formula">|Φ⁺⟩ = CNOT(H⊗I)|00⟩ = (1/√2)(|00⟩+|11⟩)</div>
                    <div class="formula">|Φ⁻⟩ = CNOT(H⊗I)|10⟩ = (1/√2)(|00⟩-|11⟩)</div>
                    <div class="formula">|Ψ⁺⟩ = CNOT(H⊗I)|01⟩ = (1/√2)(|01⟩+|10⟩)</div>
                    <div class="formula">|Ψ⁻⟩ = CNOT(H⊗I)|11⟩ = (1/√2)(|01⟩-|10⟩)</div>
                </div>
            </div>
        </section>

        <div class="nav-buttons">
            <a href="../07-multiple-qubit-gates/index.html" class="btn">Previous: Multiple-Qubit Gates</a>
            <a href="../09-swap-toffoli-gates/index.html" class="btn btn-primary">Next: SWAP & Toffoli</a>
        </div>
    </div>

    <script>
    let control = {state: 0, superposition: false};
    let target = {state: 0, superposition: false};
    let entangled = false;
    let bellState = '';
    
    function updateDisplay() {
        var cState = control.superposition ? '|+⟩' : (control.state ? '|1⟩' : '|0⟩');
        var tState = target.superposition ? '|+⟩' : (target.state ? '|1⟩' : '|0⟩');
        document.getElementById('control-state').textContent = cState;
        document.getElementById('target-state').textContent = tState;
        document.getElementById('control-toggle').className = 'qubit-toggle ' + (control.state ? 'on' : 'off');
        document.getElementById('target-toggle').className = 'qubit-toggle ' + (target.state ? 'on' : 'off');
        
        var combined, info;
        if (entangled) {
            combined = bellState;
            info = 'ENTANGLED! Cannot be written as product state.';
        } else if (control.superposition && target.superposition) {
            combined = '|++⟩';
            info = 'Separable: |+⟩⊗|+⟩ = (1/2)(|00⟩+|01⟩+|10⟩+|11⟩)';
        } else if (control.superposition) {
            combined = '|+' + target.state + '⟩';
            info = 'Separable: |+⟩⊗|' + target.state + '⟩';
        } else if (target.superposition) {
            combined = '|' + control.state + '+⟩';
            info = 'Separable: |' + control.state + '⟩⊗|+⟩';
        } else {
            combined = '|' + control.state + target.state + '⟩';
            info = 'Separable: |' + control.state + '⟩⊗|' + target.state + '⟩';
        }
        document.getElementById('combined-state').textContent = combined;
        document.getElementById('state-info').textContent = info;
    }
    
    function toggleQubit(which) {
        if (which === 'control') {
            control.state = 1 - control.state;
            control.superposition = false;
        } else {
            target.state = 1 - target.state;
            target.superposition = false;
        }
        entangled = false;
        updateDisplay();
    }
    
    function applyH(which) {
        if (which === 'control') {
            control.superposition = !control.superposition;
        } else {
            target.superposition = !target.superposition;
        }
        entangled = false;
        updateDisplay();
    }
    
    function applyCNOT() {
        if (control.superposition && !target.superposition) {
            entangled = true;
            if (target.state === 0) bellState = '(1/√2)(|00⟩+|11⟩)';
            else bellState = '(1/√2)(|01⟩+|10⟩)';
        } else if (!control.superposition && control.state === 1) {
            target.state = 1 - target.state;
            target.superposition = false;
        }
        updateDisplay();
    }
    
    function applyCZ() {
        if (control.superposition && target.superposition) {
            entangled = true;
            bellState = '(1/2)(|00⟩+|01⟩+|10⟩-|11⟩)';
        } else if ((control.superposition && target.state === 1) || (target.superposition && control.state === 1)) {
            entangled = true;
            bellState = '(1/√2)(|0⟩|+⟩+|1⟩|-⟩)';
        }
        updateDisplay();
    }
    
    function resetSimulator() {
        control = {state: 0, superposition: false};
        target = {state: 0, superposition: false};
        entangled = false;
        bellState = '';
        updateDisplay();
    }
    
    window.addEventListener('load', updateDisplay);
    </script>
</body>
</html>
